{% comment %}
  Shopify Snippet: 3D Album Cover Builder
  
  Instructions:
  1. Copy this entire file content
  2. Go to Shopify Admin → Online Store → Themes → Edit code
  3. Navigate to Snippets → Create new snippet: "album-builder"
  4. Paste this content
  5. In your product template, add: {% render 'album-builder', api_url: 'https://your-api-domain.com' %}
  
  OR use it directly in a section:
{% endcomment %}

{%- liquid
  assign api_url = api_url | default: 'https://your-api-domain.com'
  assign container_id = 'album-builder-' | append: section.id
-%}

<div id="{{ container_id }}" class="album-builder-container" data-api-url="{{ api_url }}">
  <style>
    /* Album Builder Styles - Isolated to prevent conflicts */
    #{{ container_id }} {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      width: 100%;
      max-width: 100%;
      overflow-x: hidden;
      margin: 40px 0;
      padding: 20px;
      border-radius: 8px;
    }
    
    #{{ container_id }} .main-container {
      display: flex;
      min-height: 800px;
      flex-wrap: wrap;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    #{{ container_id }} .viewer-panel {
      flex: 1;
      background: white;
      position: relative;
      display: flex;
      flex-direction: column;
      min-width: 400px;
    }
    
    #{{ container_id }} #canvas-container {
      flex: 1;
      position: relative;
      background: #fafafa;
      min-height: 600px;
    }
    
    #{{ container_id }} #editor-panel {
      flex: 1;
      padding: 20px 24px;
      overflow: auto;
      background: #ffffff;
    }
    
    /* Add other necessary styles here - see shopify-embed.html for full CSS */
    /* For brevity, including only key styles. Full version in shopify-embed.html */
  </style>
  
  <div class="main-container">
    <!-- Builder will be injected here via JavaScript -->
    <div id="builder-loading" style="width: 100%; text-align: center; padding: 40px;">
      <p>Loading 3D Album Builder...</p>
    </div>
  </div>
</div>

<script>
(function() {
  const container = document.getElementById('{{ container_id }}');
  const apiUrl = container.getAttribute('data-api-url') || '{{ api_url }}';
  
  // Load the builder iframe
  const iframe = document.createElement('iframe');
  iframe.src = 'https://your-domain.com/shopify-embed.html'; // CHANGE THIS to your HTML file URL
  iframe.style.width = '100%';
  iframe.style.minHeight = '800px';
  iframe.style.border = 'none';
  iframe.allow = 'camera; microphone; fullscreen';
  
  iframe.addEventListener('load', function() {
    // Set API URL in iframe
    iframe.contentWindow.postMessage({
      type: 'config',
      apiUrl: apiUrl
    }, '*');
    
    document.getElementById('builder-loading').style.display = 'none';
  });
  
  container.querySelector('.main-container').appendChild(iframe);
})();
</script>

{% comment %}
  ALTERNATIVE: If you want to embed directly without iframe,
  copy the entire content from shopify-embed.html and paste it here,
  then update the API_BASE_URL variable at the top of the script section.
{% endcomment %}

